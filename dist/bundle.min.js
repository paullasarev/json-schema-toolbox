"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var lodash=require("lodash"),fp=require("lodash/fp");const schemaDefault=(e,r)=>({...e,default:r,required:!0}),schemaRequired=(e,r)=>({...e,required:r}),stringSchema={type:"string"},dateSchema={type:"date"},emptyStringSchema=schemaDefault(stringSchema,""),limitedStringSchema=e=>({type:"string",maxLength:e}),numberSchema={type:"number"},booleanSchema={type:"boolean"},trueSchema=schemaDefault(booleanSchema,!0),falseSchema=schemaDefault(booleanSchema,!1),enumSchema=(e,r)=>({type:"string",enum:e,default:r});function arraySchema(e,r=[]){return{type:"array",default:r,items:e}}function requiredSchema(e){return{...e,required:lodash.keys(e.properties),additionalProperties:!1}}function exactSchema(e){return{...e,additionalProperties:!1}}function omitId(e){return lodash.omit(e,["id","title","default"])}function withId(e,r){return{...e,id:r}}function isDefined(e){return void 0!==e}function processNumber(e,r){if(isDefined(r)&&!lodash.isNull(r)&&""!==r)return lodash.isString(r)&&lodash.includes(r,",")&&(r=lodash.replace(r,/,/g,".")),Number(r)}function processString(e,r){return lodash.isUndefined(r)?r:lodash.isString(r)?r:String(r)}function processDate(e,r){return lodash.isUndefined(r)||"-"===r?e.default:r}function processNode(e,r){switch(e.type){case"object":return processObject(e,r);case"array":return processArray(e,r);case"number":return processNumber(e,r);case"string":return processString(e,r);case"date":return processDate(e,r);default:return r}}function processObject(e,r){var t=lodash.omitBy(r,lodash.isUndefined);if(lodash.isEmpty(t))return null;var a={};return r&&lodash.forOwn(r,(function(e,r){isDefined(e)&&(a[r]=e)})),lodash.forOwn(e.properties,(function(e,t){if(e.required||isDefined(r)&&isDefined(r[t])){var n=lodash.isUndefined(r)?void 0:r[t];a[t]=processNode(e,n)}})),a}function processArray(e,r){if(lodash.isUndefined(r))return e.default?e.default:void 0;var t=[];if(e.items)for(var a=0,n=r;a<n.length;a++){var i=n[a];t.push(processNode(e.items,i))}return t}var normalizeToSave=fp.curryN(2,(function(e,r){return processNode(e,r)}));function forOwn(e,r){Object.keys(e).map(t=>r(e[t],t,e))}function isDefined$1(e){return null!=e}function autoDefaults(e,r){function t(e,r){switch(e.type){case"object":return function(e,r){const a={};forOwn(e.properties,(e,n)=>{if(e.required||isDefined$1(r)&&isDefined$1(r[n])){const i=isDefined$1(r)?r[n]:void 0;a[n]=t(e,i)}}),r&&forOwn(r,(e,r)=>{!isDefined$1(a[r])&&isDefined$1(e)&&(a[r]=e)});return a}(e,r);case"array":return function(e,r){if(void 0===r)return e.default?e.default:void 0;const a=[];for(let n=0;n<r.length;n++)a.push(t(e.items,r[n]));return a}(e,r);default:return isDefined$1(r)?r:isDefined$1(e.default)?e.default:void 0}}return t(r,e)}var fillDefaults=fp.curryN(2,(function(e,r){return autoDefaults(r,e)}));function getDataBySchema(e){return function(r,t){return fillDefaults(e,t.data)}}function getDataByArraySchema(e){var r=arraySchema(e);return function(e,t){return fillDefaults(r,t.data)}}function getDefaultsBySchema(e){return function(){return fillDefaults(e,{})}}function getDefaultsByArraySchema(e){return function(){return fillDefaults(arraySchema(e),{})}}function fillDefaultsArray(e,r){return void 0===r&&(r={}),fillDefaults(arraySchema(e),r)}exports.arraySchema=arraySchema,exports.booleanSchema=booleanSchema,exports.dateSchema=dateSchema,exports.emptyStringSchema=emptyStringSchema,exports.enumSchema=enumSchema,exports.exactSchema=exactSchema,exports.falseSchema=falseSchema,exports.fillDefaults=fillDefaults,exports.fillDefaultsArray=fillDefaultsArray,exports.getDataByArraySchema=getDataByArraySchema,exports.getDataBySchema=getDataBySchema,exports.getDefaultsByArraySchema=getDefaultsByArraySchema,exports.getDefaultsBySchema=getDefaultsBySchema,exports.limitedStringSchema=limitedStringSchema,exports.normalizeToSave=normalizeToSave,exports.numberSchema=numberSchema,exports.omitId=omitId,exports.requiredSchema=requiredSchema,exports.schemaDefault=schemaDefault,exports.schemaRequired=schemaRequired,exports.stringSchema=stringSchema,exports.trueSchema=trueSchema,exports.withId=withId;
