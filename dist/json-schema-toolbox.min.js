"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var lodash=require("lodash"),fp=require("lodash/fp");function schemaDefault(e,r){return{...e,default:r,required:!0}}function schemaRequired(e,r){return{...e,required:r}}const stringSchema={type:"string"},dateSchema={type:"date"},emptyStringSchema=schemaDefault(stringSchema,""),limitedStringSchema=e=>({type:"string",maxLength:e}),numberSchema={type:"number"},booleanSchema={type:"boolean"},trueSchema=schemaDefault(booleanSchema,!0),falseSchema=schemaDefault(booleanSchema,!1);function enumSchema(e,r){return{type:"string",enum:e,default:r}}function arraySchema(e,r=[]){return{type:"array",default:r,items:e}}function requiredSchema(e){return{...e,required:lodash.keys(e.properties),additionalProperties:!1}}function exactSchema(e){return{...e,additionalProperties:!1}}function omitId(e){return lodash.omit(e,["id","title","default"])}function withId(e,r){return{...e,id:r}}function isDefined(e){return void 0!==e}function processNumber(e,r){if(isDefined(r)&&!lodash.isNull(r)&&""!==r)return lodash.isString(r)&&lodash.includes(r,",")&&(r=lodash.replace(r,/,/g,".")),Number(r)}function processString(e,r){return lodash.isUndefined(r)?r:lodash.isString(r)?r:String(r)}function processDate(e,r){return lodash.isUndefined(r)||"-"===r?e.default:r}function processNode(e,r){switch(e.type){case"object":return processObject(e,r);case"array":return processArray(e,r);case"number":return processNumber(e,r);case"string":return processString(e,r);case"date":return processDate(e,r);default:return r}}function processObject(e,r){const t=lodash.omitBy(r,lodash.isUndefined);if(lodash.isEmpty(t))return null;const n={};return r&&lodash.forOwn(r,(e,r)=>{isDefined(e)&&(n[r]=e)}),lodash.forOwn(e.properties,(e,t)=>{if(e.required||isDefined(r)&&isDefined(r[t])){const a=lodash.isUndefined(r)?void 0:r[t];n[t]=processNode(e,a)}}),n}function processArray(e,r){if(lodash.isUndefined(r))return e.default?e.default:void 0;const t=[];if(e.items)for(const n of r)t.push(processNode(e.items,n));return t}const normalizeToSave=fp.curryN(2,(e,r)=>processNode(e,r));function forOwn(e,r){Object.keys(e).map(t=>r(e[t],t,e))}function isDefined$1(e){return null!=e}function autoDefaults(e,r){function t(e,r){switch(e.type){case"object":return function(e,r){const n={};forOwn(e.properties,(e,a)=>{if(e.required||isDefined$1(r)&&isDefined$1(r[a])){const s=isDefined$1(r)?r[a]:void 0;n[a]=t(e,s)}}),r&&forOwn(r,(e,r)=>{!isDefined$1(n[r])&&isDefined$1(e)&&(n[r]=e)});return n}(e,r);case"array":return function(e,r){if(void 0===r)return e.default?e.default:void 0;const n=[];for(let a=0;a<r.length;a++)n.push(t(e.items,r[a]));return n}(e,r);default:return isDefined$1(r)?"string"===e.type&&"string"!=typeof r?String(r):"number"===e.type&&"number"!=typeof r?Number(r):r:isDefined$1(e.default)?e.default:void 0}}return t(r,e)}const fillDefaults=fp.curryN(2,(e,r)=>autoDefaults(r,e)),fillDefaultsArray=fp.curryN(2,(e,r)=>autoDefaults(r,arraySchema(e)));exports.arraySchema=arraySchema,exports.booleanSchema=booleanSchema,exports.dateSchema=dateSchema,exports.emptyStringSchema=emptyStringSchema,exports.enumSchema=enumSchema,exports.exactSchema=exactSchema,exports.falseSchema=falseSchema,exports.fillDefaults=fillDefaults,exports.fillDefaultsArray=fillDefaultsArray,exports.limitedStringSchema=limitedStringSchema,exports.normalizeToSave=normalizeToSave,exports.numberSchema=numberSchema,exports.omitId=omitId,exports.requiredSchema=requiredSchema,exports.schemaDefault=schemaDefault,exports.schemaRequired=schemaRequired,exports.stringSchema=stringSchema,exports.trueSchema=trueSchema,exports.withId=withId;
