"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("lodash"),t=require("lodash/fp");function r(e,t){return{...e,default:t,required:!0}}const n={type:"string"},i=r(n,""),u={type:"boolean"},o=r(u,!0),s=r(u,!1);function a(e,t=[]){return{type:"array",default:t,items:e}}function c(e){return void 0!==e}function f(t,r){switch(t.type){case"object":return function(t,r){const n=e.omitBy(r,e.isUndefined);if(e.isEmpty(n))return null;const i={};r&&e.forOwn(r,((e,t)=>{c(e)&&(i[t]=e)}));return e.forOwn(t.properties,((t,n)=>{if(t.required||c(r)&&c(r[n])){const u=e.isUndefined(r)?void 0:r[n];i[n]=f(t,u)}})),i}(t,r);case"array":return function(t,r){if(e.isUndefined(r))return t.default?t.default:void 0;const n=[];if(t.items)for(const e of r)n.push(f(t.items,e));return n}(t,r);case"number":return function(t,r){if(c(r)&&!e.isNull(r)&&""!==r)return e.isString(r)&&e.includes(r,",")&&(r=e.replace(r,/,/g,".")),Number(r)}(0,r);case"string":return function(t,r){return e.isUndefined(r)||e.isString(r)?r:String(r)}(0,r);case"date":return function(t,r){return e.isUndefined(r)||"-"===r?t.default:r}(t,r);default:return r}}const d=t.curryN(2,((e,t)=>f(e,t)));function p(e,t){Object.keys(e).map((r=>t(e[r],r,e)))}function l(e){return null!=e}function m(e,t){function r(e,t){switch(e.type){case"object":return function(e,t){const n={};p(e.properties,((e,i)=>{if(e.required||l(t)&&l(t[i])){const u=l(t)?t[i]:void 0;n[i]=r(e,u)}})),t&&p(t,((e,t)=>{!l(n[t])&&l(e)&&(n[t]=e)}));return n}(e,t);case"array":return function(e,t){if(void 0===t)return e.default?e.default:void 0;const n=[];for(let i=0;i<t.length;i++)n.push(r(e.items,t[i]));return n}(e,t);default:return l(t)?"string"===e.type&&"string"!=typeof t?String(t):"number"===e.type&&"number"!=typeof t?Number(t):t:l(e.default)?e.default:void 0}}return r(t,e)}const y=t.curryN(2,((e,t)=>m(t,e))),h=t.curryN(2,((e,t)=>m(t,a(e))));exports.arraySchema=a,exports.booleanSchema=u,exports.dateSchema={type:"date"},exports.emptyStringSchema=i,exports.enumSchema=function(e,t){return{type:"string",enum:e,default:t}},exports.exactSchema=function(e){return{...e,additionalProperties:!1}},exports.falseSchema=s,exports.fillDefaults=y,exports.fillDefaultsArray=h,exports.limitedStringSchema=e=>({type:"string",maxLength:e}),exports.normalizeToSave=d,exports.numberSchema={type:"number"},exports.omitId=function(t){return e.omit(t,["id","title","default"])},exports.requiredSchema=function(t){return{...t,required:e.keys(t.properties),additionalProperties:!1}},exports.schemaDefault=r,exports.schemaRequired=function(e,t){return{...e,required:t}},exports.stringSchema=n,exports.trueSchema=o,exports.withId=function(e,t){return{...e,id:t}};
